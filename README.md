# Personal Cloud 

Visit the live application [here](https://personal-cloud-web-pearl.vercel.app/)

## Setup Instructions

### Prerequisits 
> [!IMPORTANT]
> Before you start, please make sure you have the following things ready:
> - create an application on [UploadThing](https://uploadthing.com/) and get the API keys from the dashboard. 
> - Postgres Database setup in [Neon](https://neon.tech/). Ensure that the database can handle pooled connections.
> - pnpm installed

You can clone the repository by running the following command in your terminal
```sh
git clone git@github.com:rogue-kitten/personal-cloud.git
```

Move into the `apps/web` directory and copy the contents of the file `.env.example` to a new file called `.env.local` in the same directory

Replace the dummy variable values with the Database connection string and the UploadThing API key as instructed in the file. 

### Database Migrations
- Apply the migrations to your database by running the following command in your terminal. Make sure you are in the `apps/web` directory 
```sh
# apps/web
pnpm db:push
```
### Install packages and run
- Come back to the root directory of the project and run the following commands to start the development server
```sh
# install dependencies
pnpm install

# run the dev server
pnpm dev
```

## Database Schema

- users table: stores the basic user details like name, email. profile picture id and some other content as per the default user schema documented by [Auth.js](https://authjs.dev/)
- session table: to store the active sessions of the users
- accounts and authenticator tables: to store information related to the user's registered passkeys for passwordless login.
- Notes table: stores the title and content of the note, along with the created and updated timestamps, and maps into the users table based on the id field in the users table.
- Files table: stores the metadata related to the files(fileName, fileSize, mimetype), the unique file Id generated by uploadthing,  and maps it to the user who has uploaded it based on the id field of the users table.
  - the files from the drive and the photos section are added in the same table, but differentiated based on an enum column called `fileType` which can either be `document` or `image`


## Openapi End point
- You can access the openapi end point on your local system by using the following curl request
```curl
curl --location 'https://personal-cloud-web-pearl.vercel.app/api/user?limit=1&page=1&name=nash' \
--header 'x-api-key: foobarbaz'
```

Here we have added the following things: 
- `x-api-key` has been hardcoded in the code base to `foobarbaz`
- name query param to filter users based on their names
- pagination by adding the limit and page query params
